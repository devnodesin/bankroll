# Task GH-012: Column Mapping for Import

## Objective
Enhance the import functionality to allow users to map columns from their CSV/XLS files to the required import columns, providing flexibility for different file formats.

## Background
Currently, Bankroll requires exact column names (Date, Description, Withdraw, Deposit, Balance) in the import file. This limitation forces users to manually rename columns in their bank statements before importing. Column mapping will allow users to import files with any column names by mapping them to the required fields.

## Requirements

### 1. Preview and Mapping UI
- Add a "Preview & Map Columns" step before import
- Display first 3 rows of the uploaded file as preview
- Show dropdown selectors to map file columns to required fields:
  - Date → Select from file columns
  - Description → Select from file columns
  - Withdraw → Select from file columns
  - Deposit → Select from file columns
  - Balance → Select from file columns
- Auto-detect and pre-select columns based on name similarity
- Highlight required vs optional fields
- Show clear "Continue Import" button after mapping

### 2. Auto-Detection Logic
- Match columns case-insensitively
- Support common variations:
  - Date: date, transaction date, txn date, posting date
  - Description: description, desc, particulars, details, narration
  - Withdraw: withdraw, withdrawal, debit, dr, amount debited
  - Deposit: deposit, credit, cr, amount credited
  - Balance: balance, closing balance, available balance
- Select best match automatically
- Allow users to override auto-detected mappings

### 3. Backend Changes
- Add `/transactions/preview` endpoint:
  - Accept file upload
  - Return first 3 rows with column headers
  - Return auto-detected column mappings
- Modify `/transactions/import` endpoint:
  - Accept column mapping parameter (JSON)
  - Use mapped columns instead of exact name matching
  - Validate that all required columns are mapped
  - Continue with existing validation and import logic

### 4. Validation
- Ensure all required columns are mapped
- Detect duplicate mappings (same column mapped twice)
- Validate that mapped columns exist in the file
- Show clear error messages for mapping issues

### 5. User Experience
- Preserve existing direct import for files with exact column names
- Show preview/mapping modal only when columns don't match exactly
- Display helpful tooltips explaining each field
- Show loading state during preview generation
- Allow users to go back and select a different file

## Acceptance Criteria
- [ ] Users can upload files with any column names
- [ ] Preview shows first 3 rows of data
- [ ] Column mapping dropdowns show all available columns
- [ ] Auto-detection selects correct columns in common cases
- [ ] Users can manually adjust mappings
- [ ] Import succeeds with correct data mapping
- [ ] Validation catches mapping errors
- [ ] Tests cover preview and mapping scenarios
- [ ] README.md updated with column mapping documentation
- [ ] UI is responsive and user-friendly

## Technical Notes
- Use existing file upload validation (5MB, xlsx/xls/csv)
- Store mapping in session or pass as POST parameter
- Reuse existing date/amount parsing functions
- Keep backward compatibility with exact column names
- Add comprehensive test cases

## Example Flow
1. User uploads file with columns: "Txn Date", "Details", "Debit", "Credit", "Closing Bal"
2. System shows preview with first 3 rows
3. System auto-maps:
   - Date ← Txn Date
   - Description ← Details
   - Withdraw ← Debit
   - Deposit ← Credit
   - Balance ← Closing Bal
4. User reviews and adjusts if needed
5. User clicks "Import" to proceed
6. Import processes with mapped columns

## References
- Current import logic in `src/app/Http/Controllers/ImportController.php`
- Import UI in `src/resources/views/home.blade.php`
- Import tests in `src/tests/Feature/ImportTest.php`
